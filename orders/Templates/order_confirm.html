{%extends 'base.html'%}
{%load static%}
{%block title%}Order Placing{%endblock title%}
{%block scripts%}
<script>
    function Increase_quantity(id, quantity) {
        fetch(`{%url 'update_quantity'%}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{csrf_token}}'
            },
            body: JSON.stringify({ action: "increase", id: id }),
        }).then((response) => response.json())
            .then((data) => {
                document.querySelector(`#quantity${id}`).innerHTML = data.quantity
            })
            .catch((error) => console.log({ "error": error.message }))
    }

    function Decrease_quantity(id, quantity) {
        fetch(`{%url 'update_quantity'%}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{csrf_token}}'
            },
            body: JSON.stringify({ action: "descrease", id: id }),
        }).then((response) => response.json())
            .then((data) => {
                document.querySelector(`#quantity${id}`).innerHTML = data.quantity
            })
            .catch((error) => console.log({ "error": error.message }))
    }
</script>
{%endblock scripts%}
{%block body%}
<!-- <div class="fixed top-0 left-0 w-[100dvw] h-[100dvh] flex items-center justify-center bg-black/25 overflow-hidden">
    <div class="px-6 py-6 rounded-md shadow-xl bg-white flex flex-col justify-center items-center">
        <img src="{%static '/images/submited.gif'%}" class="h-45">
        <p class="font-medium">Order has been Placed</p>
        <p class="text-xs">Redirecting to home page in <span id="seconds">5</span> Seconds</p>
    </div>
</div> -->
<main class="px-2 flex flex-col gap-12 justify-center items-center py-12">
    <h1 class="font-medium text-2xl">Confirm Order</h1>
    <div class="w-full">
        <div class="flex flex-col gap-2.5 bg-zinc-200/25 shadow rounded-xl ml-1 mr-1 p-4">
            <div class="flex flex-row gap-2  px-3 py-2">
                <p class="font-medium">Customer Name:</p>
                <p class="font-medium">{{request.user.first_name}}{{request.user.last_name}}</p>
            </div>
            <div class="flex flex-row gap-2   px-3 py-2">
                <p class="font-medium">Delivery Address:</p>
                <p class="font-medium">{{request.user.address}} {{request.user.city}} {{request.user.state}}</p>
            </div>
            <div class="flex flex-row gap-2   px-3 py-2">
                <p class="font-medium">Phone Number:</p>
                <p class="font-medium">{{request.user.phone}}</p>
            </div>
            <a class="bg-[#061129] w-fit self-end text-white font-medium px-8 py-2 rounded-4xl active:shadow-none active:bg-[#061129] hover:bg-[#061129]/85"
                href="{%url 'update_order_info'%}">Update Address</a>
        </div>
        <div class="flex flex-col gap-2.5 pt-5 pb-5">
            {%for item in cart.items.all%}
            <div class="w-full shadow rounded-md px-2 py-2 flex flex-col md:flex-row">
                {%if item.product.preview.preview1%}
                <img src="{{item.product.preview.preview1}}" class="h-40 object-contain" />
                {%endif%}
                <div class="flex flex-col gap-2.5 px-1">
                    <p class="font-semibold line-clamp-1 md:line-clamp-none">{{item.product.fullname}}</p>
                    <p class="font-semibold">${{item.product.price}}</p>
                    <div class="flex flex-row gap-5 justify-between md:justify-normal">
                        <div>
                            <button onclick="Decrease_quantity('{{item.id}}','{{item.quantity}}')"
                                class="hover:bg-zinc-500 rounded-md p-1 hover:text-white active:bg-white active:text-black"><i
                                    class="fa-solid fa-minus"></i></button>
                            <span class="px-2 font-medium border py-1 rounded"
                                id="quantity{{item.id}}">{{item.quantity}}</span>
                            <button onclick="Increase_quantity('{{item.id}}','{{item.quantity}}')"
                                class="hover:bg-zinc-500 rounded-md p-1 hover:text-white active:bg-white active:text-black"><i
                                    class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            {%endfor%}
            <div
                class="border-t flex flex-col md:flex-row justify-between justify-items-normal md:items-center pt-2 gap-5">
                <div class="flex flex-row gap-2.5">
                    <p class="font-semibold">Total:</p>
                    <p class="font-medium">${{cart.get_total_price}}</p>
                </div>
            </div>
            <form method="POST" action="{%url 'order_confirm' %}" class="w-full flex justify-center items-center">
                {%csrf_token%}
                <button
                    class="bg-[#061129] w-fit self-center text-white font-medium px-8 py-2 rounded-4xl active:shadow-none active:bg-[#061129] hover:bg-[#061129]/85">
                    Place Order
                </button>
            </form>
        </div>
    </div>
</main>
{%endblock body%}